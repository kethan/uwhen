!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).uwhen=t()}(this,(function(){"use strict";var e=new Set;function t(t,n){var o=new Set;function i(){document.querySelectorAll(t).forEach((function(i){if(!o.has(i)){o.add(i);var c=n(i),u="function"==typeof c?c:function(){};!function(t,n,o){function i(){n&&document.contains(n)&&n.matches(t)||(e.delete(i),o())}setTimeout(i),e.add(i)}(t,i,(function(){o.delete(i),u()}))}}))}setTimeout(i),e.add(i)}new window.MutationObserver((function(){e.forEach((function(e){return e()}))})).observe(document,{attributes:!0,childList:!0,subtree:!0});var n="function"==typeof Promise?Promise:function(e){let t,n=[],o=0;return e((e=>{t=e,o=1,n.splice(0).forEach(i)})),{then:i};function i(e){return o?setTimeout(e,0,t):n.push(e),this}};const o=e=>{const{$:t,r:n,h:o}=e;r(n)&&(i.get(o).delete(e),n()),r(e.r=t())&&i.get(o).add(e)},i=new WeakMap,c=[],u=[],r=e=>"function"==typeof e,f=e=>{const t={h:n,c:null,a:null,e:0,i:0,s:[]};return n;function n(){t.e=t.i=0;try{return e.apply(t.c=this,t.a=arguments)}finally{c.length&&s.then(c.forEach.bind(c.splice(0),o)),u.length&&u.splice(0).forEach(o)}}},s=new n((e=>e()));return when=(e,n)=>{t(e,(e=>{const t=[...e.childNodes],o={};for(const n of e.attributes)o[[n.name]]=n.value;const c=f((()=>n(e,o,t)));return c(),()=>{(e=>i.has(e))(c)&&(e=>{const t=i.get(e);t&&s.then((()=>{t.forEach((e=>{e.r(),e.r=null})),t.clear()}))})(c)}}))}}));
